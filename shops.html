<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NearX â€” Local Stores & WhatsApp Ordering</title>

<style>
  :root{
    --max-w:1100px;
    --accent1:#246BFD;
    --accent2:#6A11CB;
    --accent3:#FF7B00;
    --bg:#ffffff;
    --muted:#707582;
    --card:#ffffff;
    --radius:14px;
    --shadow:0 12px 30px rgba(10,10,40,0.06);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto;
    background:linear-gradient(180deg,#f7f9ff,#ffffff);
    color:#0b1221;
    -webkit-font-smoothing:antialiased;
  }
  a{text-decoration:none;color:inherit}
  .wrap{max-width:var(--max-w);margin:18px auto;padding:18px}

  /* HEADER */
  header{display:flex;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:52px;height:52px;border-radius:12px;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    display:flex;align-items:center;justify-content:center;
    color:#fff;font-weight:800;font-size:22px;
  }
  h1{margin:0;font-size:20px}
  .tag{color:var(--muted);font-size:13px;margin-top:4px}

  /* HERO */
  .hero{
    background:linear-gradient(135deg,rgba(36,107,253,0.95),rgba(106,17,203,0.95));
    color:#fff;padding:28px;border-radius:22px;
    box-shadow:var(--shadow);
    display:flex;gap:18px;align-items:center;justify-content:space-between;
    margin-top:16px;
  }
  .hero-left{max-width:68%}
  .hero h2{margin:0;font-size:26px;font-weight:800}
  .hero p{opacity:.95;margin-top:6px}

  .searchbar{
    display:flex;gap:10px;background:rgba(255,255,255,0.12);
    padding:8px;border-radius:12px;margin-top:10px;
  }
  .searchbar input{
    flex:1;padding:12px;border:0;background:transparent;color:#fff;font-size:15px;
  }
  .searchbar select{
    padding:10px;border:0;background:transparent;color:#fff;font-weight:700;
    border-radius:10px;
  }
  .searchbar button{
    background:#fff;border:0;padding:10px 14px;border-radius:10px;font-weight:700;
  }

  /* CATEGORY LIST */
  .cats{display:flex;gap:10px;overflow:auto;margin-top:14px}
  .cat{
    min-width:110px;background:#fff;padding:12px;border-radius:14px;
    display:flex;flex-direction:column;align-items:center;gap:8px;
    box-shadow:var(--shadow);cursor:pointer;
  }
  .cat img{width:44px;height:44px;border-radius:10px}

  /* MAIN GRID */
  main{display:flex;gap:22px;margin-top:20px}
  .left{flex:1}
  .right{width:360px}

  .grid{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:16px;
  }
  .store-card{
    background:#fff;padding:14px;border-radius:18px;box-shadow:var(--shadow);
    display:flex;gap:12px;
  }
  .thumb{width:86px;height:86px;border-radius:12px;object-fit:cover}
  .meta{font-size:13px;color:var(--muted)}

  .btn{
    padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;
  }
  .btn-ghost{background:transparent;border:2px solid rgba(10,10,30,0.06)}
  .btn-primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff}

  /* CART */
  .cart{
    background:#fff;padding:14px;border-radius:16px;
    box-shadow:var(--shadow);position:sticky;top:20px;
  }
  .cart-row{
    padding:8px 0;border-bottom:1px dashed #eee;
    display:flex;justify-content:space-between;
  }

  /* MODAL */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(0,0,0,0.45);
    display:none;align-items:center;justify-content:center;
    z-index:200;
  }
  .modal{
    width:95%;max-width:860px;background:#fff;padding:18px;border-radius:14px;
    box-shadow:0 30px 60px rgba(10,10,40,0.3);
  }
  .prod-grid{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));
    gap:12px;margin-top:12px;
  }
  .prod{
    padding:10px;border-radius:12px;border:1px solid #f1f4fb;
  }
  .prod img{width:100%;height:110px;object-fit:cover;border-radius:8px}

  @media(max-width:980px){
    main{flex-direction:column}
    .right{width:100%;position:relative}
  }
</style>
</head>
<body>

<div class="wrap">

<header>
  <div class="brand">
    <div class="logo">NX</div>
    <div>
      <h1>NearX Stores</h1>
      <div class="tag">Everything near you â€” order on WhatsApp</div>
    </div>
  </div>

  <div style="display:flex;gap:10px">
    <a href="index.html" class="btn btn-ghost">Home</a>
    <a href="crm.html" class="btn btn-ghost">CRM</a>
    <button class="btn btn-primary" id="merchantJoinBtn">List Your Shop</button>
  </div>
</header>

<section class="hero">
  <div class="hero-left">
    <h2>Find stores, compare prices & order on WhatsApp</h2>
    <p>Local search that actually works â€” merchant-updated product lists.</p>

    <div class="searchbar">
      <input id="q" placeholder="Search â€” sugar, rice, bakery, etc.">
      <select id="area"></select>
      <button id="searchBtn">Search</button>
    </div>

    <div class="cats" id="categories"></div>
  </div>
</section>

<main>

  <div class="left">
    <h3>Nearby Stores</h3>
    <div class="grid" id="storesGrid"></div>
  </div>

  <aside class="right">
    <div class="cart">
      <h4>Your Cart</h4>
      <div id="cartItems">No items</div>
      <div class="cart-row"><strong>Total</strong><strong id="cartTotal">â‚¹0</strong></div>

      <input id="custName" placeholder="Your Name" style="margin-top:10px;padding:10px;border-radius:10px;border:1px solid #eee">
      <input id="custPhone" placeholder="WhatsApp Number" style="margin-top:10px;padding:10px;border-radius:10px;border:1px solid #eee">

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="clearCart" class="btn btn-ghost">Clear</button>
        <button id="checkoutBtn" class="btn btn-primary">Checkout on WhatsApp</button>
      </div>
    </div>
  </aside>

</main>

<footer style="margin-top:30px;text-align:center;color:var(--muted)">
  Â© <span id="year"></span> NearX Stores â€” Powered by WhatsApp
</footer>

</div>

<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 id="modalTitle">Store</h3>
      <button class="btn btn-ghost" id="closeModal">Close</button>
    </div>
    <p id="modalDesc" style="color:var(--muted)"></p>
    <div class="prod-grid" id="prodGrid"></div>
  </div>
</div>

<div class="modal-backdrop" id="merchantModal">
  <div class="modal">
    <h3>List Your Shop on NearX</h3>
    <p style="color:var(--muted)">We will create your shop ID & product sheet.</p>

    <form id="merchantForm" style="display:grid;gap:10px">
      <input name="shop_name" placeholder="Shop Name" required>
      <input name="owner_name" placeholder="Owner Name">
      <input name="phone" placeholder="WhatsApp Number" required>
      <input name="area" placeholder="Area / Locality" required>

      <select name="category" required>
        <option>Grocery</option>
        <option>Bakery</option>
        <option>Restaurant</option>
        <option>Pharmacy</option>
        <option>Electronics</option>
        <option>Fashion</option>
      </select>

      <textarea name="notes" placeholder="Short description"></textarea>

      <input type="hidden" name="action" value="merchant_signup">

      <div style="display:flex;gap:10px">
        <button type="button" class="btn btn-ghost" id="closeMerchant">Cancel</button>
        <button class="btn btn-primary">Submit</button>
      </div>

      <div id="merchantMsg" style="display:none;color:green;font-weight:700"></div>
    </form>
  </div>
</div>

<script>
document.getElementById("year").innerText = new Date().getFullYear();

-----------------------------------------------------------
/* ðŸ”— CONFIG â€” replace later when backend ready */
-----------------------------------------------------------
const DATA_URL = "REPLACE_WITH_YOUR_DATA_ENDPOINT_OR_RAW_JSON_URL";
const MERCHANT_FORM_URL = "https://script.google.com/macros/s/AKfycbzWG-cW2jMbgEEbDrMnlMO995nMk8wravDiQ4gGJf5BuStUm0ND5SU5i_yL6veY8FI/exec";
const OWNER_PHONE_DEFAULT = "919000810084";

-----------------------------------------------------------
/* DEMO DATA (works even without backend) */
-----------------------------------------------------------
const demoData = {
  stores:[
    {
      id:"S001",
      name:"Fresh Mart",
      category:"Grocery",
      area:"Dilsukhnagar",
      phone:"919000810084",
      thumb:"https://i.ibb.co/5xWt7gRM/file-00000000c66c7209aa546551ca843503-1.png",
      desc:"Daily groceries & staples"
    },
    {
      id:"S002",
      name:"Bakers Hub",
      category:"Bakery",
      area:"LB Nagar",
      phone:"919111111111",
      thumb:"https://i.ibb.co/5xWt7gRM/file-00000000c66c7209aa546551ca843503-1.png",
      desc:"Fresh breads & cakes"
    }
  ],
  products:[
    {shop_id:"S001",product:"Sugar 1kg",price:45,stock:30,image:"https://i.ibb.co/5xWt7gRM/file.png"},
    {shop_id:"S001",product:"Rice 5kg",price:325,stock:12,image:"https://i.ibb.co/5xWt7gRM/file.png"},
    {shop_id:"S002",product:"Chocolate Cake",price:350,stock:6,image:"https://i.ibb.co/5xWt7gRM/file.png"}
  ],
  categories:["Grocery","Bakery","Restaurant","Pharmacy","Fashion"]
};

let stores=[],products=[],categories=[];
let cart=[];
let selectedStoreId=null;

function money(n){return "â‚¹"+Number(n||0).toFixed(0);}

-----------------------------------------------------------
/* FETCH DATA */
-----------------------------------------------------------
async function loadData(){
  if(!DATA_URL.includes("http")){
    stores=demoData.stores;
    products=demoData.products;
    categories=demoData.categories;
    initUI();
    return;
  }
  try{
    const res=await fetch(DATA_URL);
    const json=await res.json();
    stores=json.stores||[];
    products=json.products||[];
    categories=[...new Set(stores.map(s=>s.category))];
  }catch(e){
    stores=demoData.stores;
    products=demoData.products;
    categories=demoData.categories;
  }
  initUI();
}

function initUI(){
  loadAreas();
  loadCategories();
  renderStores(stores);
}

function loadAreas(){
  const area=document.getElementById("area");
  area.innerHTML="";
  area.appendChild(new Option("All Areas",""));
  [...new Set(stores.map(s=>s.area))].forEach(a=>{
    area.appendChild(new Option(a,a));
  });
}

function loadCategories(){
  const cats=document.getElementById("categories");
  cats.innerHTML="";
  categories.forEach(c=>{
    const div=document.createElement("div");
    div.className="cat";
    div.innerHTML=`<img src="https://via.placeholder.com/64?text=${c[0]}"><div>${c}</div><small>Tap to search</small>`;
    div.onclick=()=>{
      document.getElementById("q").value=c;
      searchStores();
    };
    cats.appendChild(div);
  });
}

-----------------------------------------------------------
/* STORE LISTING */
-----------------------------------------------------------
function renderStores(list){
  const grid=document.getElementById("storesGrid");
  grid.innerHTML="";
  if(!list.length){
    grid.innerHTML="<div style='color:var(--muted)'>No stores found</div>";
    return;
  }
  list.forEach(s=>{
    const div=document.createElement("div");
    div.className="store-card";
    div.innerHTML=`
      <img class="thumb" src="${s.thumb}">
      <div>
        <h3>${s.name}</h3>
        <div class="meta">${s.category} â€¢ ${s.area}</div>
        <div class="meta">${s.desc||""}</div>
        <div style="margin-top:6px;display:flex;gap:8px">
          <button class="btn btn-ghost" onclick="openStore('${s.id}')">View</button>
          <button class="btn btn-primary" onclick="openStore('${s.id}')">Order</button>
        </div>
      </div>
    `;
    grid.appendChild(div);
  });
}

-----------------------------------------------------------
/* SEARCH SYSTEM */
-----------------------------------------------------------
function searchStores(){
  let q=document.getElementById("q").value.toLowerCase();
  let area=document.getElementById("area").value;

  if(q){
    const matched=products.filter(p=>p.product.toLowerCase().includes(q));
    if(matched.length){
      const ids=[...new Set(matched.map(m=>m.shop_id))];
      const list=stores.filter(s=>ids.includes(s.id)&&(area?s.area===area:true));
      renderStores(list);
      return;
    }
  }
  const list=stores.filter(s=>{
    const matchQ=!q||s.name.toLowerCase().includes(q)||s.category.toLowerCase().includes(q)||(s.desc||"").toLowerCase().includes(q);
    const matchA=!area||s.area===area;
    return matchQ&&matchA;
  });
  renderStores(list);
}

document.getElementById("searchBtn").onclick=searchStores;
document.getElementById("q").onkeydown=e=>{if(e.key==="Enter")searchStores();};

-----------------------------------------------------------
/* OPEN STORE PRODUCT MODAL */
-----------------------------------------------------------
function openStore(id){
  selectedStoreId=id;
  const s=stores.find(x=>x.id===id);
  const prodList=products.filter(p=>p.shop_id===id);

  document.getElementById("modalTitle").innerText=s.name;
  document.getElementById("modalDesc").innerText=s.desc||"";

  const grid=document.getElementById("prodGrid");
  grid.innerHTML="";

  if(!prodList.length){
    grid.innerHTML="<div style='color:var(--muted)'>No products added yet</div>";
  } else {
    prodList.forEach(p=>{
      const div=document.createElement("div");
      div.className="prod";
      div.innerHTML=`
        <img src="${p.image}">
        <div>${p.product}</div>
        <div>${money(p.price)}</div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input type="number" min="1" value="1" style="width:70px;padding:6px;border-radius:8px;border:1px solid #eee" id="qty-${p.product}">
          <button class="btn btn-primary" onclick="addToCart('${p.product}',${p.price})">Add</button>
        </div>
      `;
      grid.appendChild(div);
    });
  }

  showModal("modalBackdrop");
}

document.getElementById("closeModal").onclick=()=>hideModal("modalBackdrop");

-----------------------------------------------------------
/* CART SYSTEM */
-----------------------------------------------------------
function addToCart(product,price){
  const qty=document.querySelector(`#qty-${product}`).value;
  const item={product,price,qty:Number(qty),shop_id:selectedStoreId};

  if(cart.length&&cart[0].shop_id!==item.shop_id){
    if(!confirm("Cart has items from another shop. Clear cart?"))return;
    cart=[];
  }

  const found=cart.find(c=>c.product===product);
  if(found) found.qty+=item.qty;
  else cart.push(item);

  renderCart();
}

function renderCart(){
  const div=document.getElementById("cartItems");
  div.innerHTML="";

  if(!cart.length){
    div.innerHTML="No items";
    document.getElementById("cartTotal").innerText="â‚¹0";
    return;
  }

  let total=0;
  cart.forEach((c,i)=>{
    total+=c.price*c.qty;
    const row=document.createElement("div");
    row.className="cart-row";
    row.innerHTML=`
      <div>${c.product} x${c.qty}</div>
      <div>${money(c.price*c.qty)} <button class="btn btn-ghost" onclick="removeItem(${i})">âœ•</button></div>
    `;
    div.appendChild(row);
  });

  document.getElementById("cartTotal").innerText=money(total);
}

function removeItem(i){
  cart.splice(i,1);
  renderCart();
}

document.getElementById("clearCart").onclick=()=>{cart=[];renderCart();};

-----------------------------------------------------------
/* CHECKOUT â†’ WhatsApp */
-----------------------------------------------------------
document.getElementById("checkoutBtn").onclick=()=>{

  if(!cart.length){
    alert("Cart empty");
    return;
  }

  const name=document.getElementById("custName").value.trim();
  const phone=document.getElementById("custPhone").value.trim();

  if(!name || !phone){
    alert("Enter name & WhatsApp number");
    return;
  }

  const store=stores.find(s=>s.id===cart[0].shop_id);
  const merchant=store.phone||OWNER_PHONE_DEFAULT;

  let msg=`Hi, I want to place an order:\n\nName: ${name}\nPhone: ${phone}\n\nItems:\n`;

  cart.forEach(c=>{
    msg+=`â€¢ ${c.product} x${c.qty} - ${money(c.price*c.qty)}\n`;
  });

  const total=cart.reduce((s,c)=>s+c.price*c.qty,0);
  msg+=`\nTotal: ${money(total)}\n\nStore: ${store.name}`;

  window.open(`https://wa.me/${merchant}?text=${encodeURIComponent(msg)}`,"_blank");
};

-----------------------------------------------------------
/* MERCHANT FORM */
-----------------------------------------------------------
document.getElementById("merchantJoinBtn").onclick=()=>showModal("merchantModal");
document.getElementById("closeMerchant").onclick=()=>hideModal("merchantModal");

document.getElementById("merchantForm").onsubmit=async(e)=>{
  e.preventDefault();

  const form=new FormData(e.target);
  let data={};
  for(const [k,v] of form.entries()) data[k]=v;

  const res = await fetch(MERCHANT_FORM_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });

  // You might want to check res.ok here for a better response
  document.getElementById("merchantMsg").innerText="Request sent!";
  document.getElementById("merchantMsg").style.display="block";
  e.target.reset();
};

-----------------------------------------------------------
/* MODAL HELPERS */
-----------------------------------------------------------
function showModal(id){document.getElementById(id).style.display="flex";}
function hideModal(id){document.getElementById(id).style.display="none";}

loadData();
</script>

</body>
</html>
